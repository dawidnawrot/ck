<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Composer · docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;single-file-composer&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#single-file-composer&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Single file composer&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Composer · docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dawidnawrot.github.io/ck_docusaurus/"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;single-file-composer&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#single-file-composer&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Single file composer&lt;/h2&gt;
"/><meta property="og:image" content="https://dawidnawrot.github.io/ck_docusaurus/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://dawidnawrot.github.io/ck_docusaurus/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/ck_docusaurus/img/circlek.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/ck_docusaurus/css/main.css"/><script src="/ck_docusaurus/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/ck_docusaurus/"><img class="logo" src="/ck_docusaurus/img/ck.png" alt="docs"/><h2 class="headerTitleWithLogo">docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/ck_docusaurus/docs/drupal-europe/intro" target="_self">Drupal Europe</a></li><li class=""><a href="/ck_docusaurus/docs/drupal-innercircle/intro" target="_self">Drupal InnerCircle</a></li><li class=""><a href="/ck_docusaurus/docs/lando/intro" target="_self">Lando</a></li><li class=""><a href="/ck_docusaurus/docs/docusaurus/development" target="_self">Docusaurus</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Drupal Europe</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Drupal Europe</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ck_docusaurus/docs/drupal-europe/intro">Intro</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/ck_docusaurus/docs/drupal-europe/composer">Composer</a></li><li class="navListItem"><a class="navItem" href="/ck_docusaurus/docs/drupal-europe/split-config-translations">Split config translations</a></li><li class="navListItem"><a class="navItem" href="/ck_docusaurus/docs/drupal-europe/environment-global-setting">Environment global setting</a></li><li class="navListItem"><a class="navItem" href="/ck_docusaurus/docs/drupal-europe/troubleshooting">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/ck_docusaurus/docs/drupal-europe/migrations">Migrate</a></li><li class="navListItem"><a class="navItem" href="/ck_docusaurus/docs/drupal-europe/aws">AWS</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Composer</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="single-file-composer"></a><a href="#single-file-composer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Single file composer</h2>
<p>Although there are several projects we're working on there's just one common composer file shared across all the sites.</p>
<h2><a class="anchor" aria-hidden="true" id="justification"></a><a href="#justification" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Justification</h2>
<p>This is becasue it's easy to keep it up to date and easy to maintain. The one and only disadvantage of that kind of approach is that some (not much) projects / modules are downloaded and never used / installed. I've tried to implement multiple composer files but it's difficult to maintain (you can read about that kind of approach in &quot;Pitfalls&quot; section). Currently composer.json and composer.lock files are part of profile repository. It's placed in the root dir of this repo. During the deployment it's coppied to single site directory and then installed. If you provide any new projects to composer you supposed create a new branch in profile repo and copy it back (both composer.json and composer.lock).</p>
<h2><a class="anchor" aria-hidden="true" id="pitfalls"></a><a href="#pitfalls" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pitfalls</h2>
<p>The initial idea was to create one global composer.json which would be part of profile (similarily to the one above). However this composer.json file would use <a href="https://github.com/wikimedia/composer-merge-plugin"><code>wikimedia/composer-merge-plugin</code></a> plugin which allows to <code>include</code> external (additional) composer files. So, when deployment process happens for the first time composer.json and composer.lock are copied from profile into site directory, but there's also an additional composer.local.json file that's part of site repo. In the main composer.json file in extra section we have:</p>
<pre><code class="hljs"><span class="hljs-attr">"extra":</span> <span class="hljs-string">{</span>
<span class="hljs-attr">        "merge-plugin":</span> <span class="hljs-string">{</span>
<span class="hljs-attr">            "include":</span> <span class="hljs-string">[</span>
                <span class="hljs-string">"composer.local.json"</span>
            <span class="hljs-string">],</span>
<span class="hljs-attr">            "recurse":</span> <span class="hljs-literal">false</span><span class="hljs-string">,</span>
<span class="hljs-attr">            "replace":</span> <span class="hljs-literal">false</span>
        <span class="hljs-string">}</span>
    <span class="hljs-string">}</span>
</code></pre>
<p>This allows to include local composer.local.json file and dependencies are downloaded. It works great, but the process of moving main composer.json file back to profile is tedious. This plugin allows to combine several external composer.json files, but we can only have single composer.lock file. So, in order to move it back we would have to edit manually composer.lock file and remove dependencies that are part of local site. Moreover this gets us to the point where we need to specify exact version of the dependency / module in composer.local.json file, we can't use range because eventually next developer might end up with different version of the module / dependency. So, this approach makes it quite complex and that's why it's easier to maintain just a single composer.json and composer.lock files.</p>
<h2><a class="anchor" aria-hidden="true" id="update-1092019"></a><a href="#update-1092019" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UPDATE 1.09.2019</h2>
<p>After deep investigation I've decided to stay with just a single composer file that is storred in profile <code>./composer.json</code> main directory. I've tried to create a separate composer for site and for profile, but it didn't work. Composer file for profile contained all the dependencies including drupal core, modules, patches etc. Site composer file on the other hand contained a profile composer dependency and other site dependencies like additional modules specific to the site, like so:</p>
<pre><code class="hljs"><span class="hljs-string">"repositories"</span>: [
    {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"git"</span>,
        <span class="hljs-string">"url"</span>: <span class="hljs-string">"git@github.com:dawidnawrot/ck_profile.git"</span>
    },
    {
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"composer"</span>,
          <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://packages.drupal.org/8"</span>
    }
  ],
  <span class="hljs-string">"require"</span>: {
      <span class="hljs-string">"dawidnawrot/ck_profile"</span>: <span class="hljs-string">"dev-drupal_only"</span>,
      <span class="hljs-string">"drupal/admin_toolbar"</span>: <span class="hljs-string">"^2.1"</span>
  },
</code></pre>
<p>The problem was and <code>extra</code> section in profile composer file:</p>
<pre><code class="hljs"><span class="hljs-string">"extra"</span>: {
    <span class="hljs-string">"installer-paths"</span>: {
        <span class="hljs-string">"web/core"</span>: [<span class="hljs-string">"type:drupal-core"</span>]
    }
}
</code></pre>
<p>When I ran <code>composer install</code> from main profile directory my drupal core end up in /web directory, however when I ran <code>composer install</code> from site (which requires profile composer) my drupal core (and other drupal specific elements like modules, themes, etc which are not listed here just for simplicity reasons) end up in main directory instead of ./web dir. It turned out that composer ignores <code>extra</code> section for transitive dependencies. So, it's not just installer-paths but also if there were defined any drupal patches it also woudn't be installed. Only the last composer file and its <code>extra</code> section is triggered. Of course I could include overrides in last composer file which is the site composer and it would work for location of drupal core but not for patches. And that is just one issue, who knows what else we will have in extra section in the future. So with that said it's easier to stay with a single composer file, of course the consequence of keepnig single composer file is that all contrib modules are going to be shared in all sites, but not all of them are going to be enabled. For now there's no such module which is not enabled because we're working on core functionalities, but maybe in the future there's going to be a contrib module that is specific to certain site, but it's spread across all sites - the thing is it's going to be enabled on particular site, becasue that's what config_split allows for, so not much of a pain. There also was an option to bring some post install hooks and move files accordingly, but it's too much work and not much of advantage.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/ck_docusaurus/docs/drupal-europe/intro"><span class="arrow-prev">← </span><span>Intro</span></a><a class="docs-next button" href="/ck_docusaurus/docs/drupal-europe/split-config-translations"><span>Split config translations</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#single-file-composer">Single file composer</a></li><li><a href="#justification">Justification</a></li><li><a href="#pitfalls">Pitfalls</a></li><li><a href="#update-1092019">UPDATE 1.09.2019</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/ck_docusaurus/" class="nav-home"><img src="/ck_docusaurus/img/circlek.svg" alt="docs" width="66" height="58"/></a><div><h5>Docs</h5><a href="/ck_docusaurus/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/ck_docusaurus/docs/en/doc2.html">Guides (or other categories)</a><a href="/ck_docusaurus/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/ck_docusaurus/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/ck_docusaurus/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/ck_docusaurus/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Your Name or Your Company Name</section></footer></div></body></html>